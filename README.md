<h1>Examine-alerts-logs-and-rules-with-Suricata</h1>

<h2>Description</h2>
In this scenario, I'm a security analyst who must monitor traffic on your employer's network. You’ll be required to configure Suricata and use it to trigger alerts.

I will analyze a network packet capture file that contains traffic data related to a user connecting to an internet site. The ability to filter network traffic using packet sniffers to gather relevant information is an essential skill as a security analyst.

Here’s how you'll do this task: 
* First, you'll explore custom rules in Suricata. 
* Second, you'll run Suricata with a custom rule in order to trigger it, and examine the output logs in the fast.log file. 
* Finally, you’ll examine the additional output that Suricata generates in the standard eve.json log file.
<br />


<h2>Languages and Utilities Used</h2>

- <b>Suricata</b> 

<h2>Lab walk-through:</h2>

<p align="center">
Task 1: Examine a custom rule in Suricata.
  <br>
Use the cat command to display the rule in the custom.rules file:<br/>
  
```
   cat custom.rules
```

The command returns the rule as the output in the shell:
```
  alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"GET on wire";
  flow:established,to_server; content:"GET"; http_method; sid:12345;
  rev:3;)
```
<br />
<br />
<p align="center">
Task 2: Trigger a custom rule in Suricata
  <br>
1.List the files in the /var/log/suricata folder:
  <br>
2.Run suricata using the custom.rules and sample.pcap files:
<img src="https://i.gyazo.com/589647020c81a6eacf761ae493e0df7f.png" height="80%" width="80%" alt="tcpdump"/>
  <br>
3. List the files in the /var/log/suricata folder again:
<br>
4. Use the cat command to display the fast.log file generated by Suricata:
<img src="https://i.gyazo.com/5e179128dfabb287434d84202dcffdb9.png" height="80%" width="80%" alt="tcpdump"/>   


  <p align="center">
The output returns alert entries in the log:


```
11/23/2022-12:38:34.624866  [**] [1:12345:3] GET on wire [**] [Classification: (null)] [Priority: 3] {TCP} 172.21.224.2:49652 -> 142.250.1.139:80
11/23/2022-12:38:58.958203  [**] [1:12345:3] GET on wire [**] [Classification: (null)] [Priority: 3] {TCP} 172.21.224.2:58494 -> 142.250.1.139:80
```

<p align="center">  
Task 3:  Examine eve.json output 
  <br>
  1. Use the cat command to display the entries in the eve.json file:
  <br>
  2. Use the jq command to display the entries in an improved format:
<br>
  
  ```
analyst@ee69e3317af7:~$ cat /var/log/suricata/fast.log
11/23/2022-12:38:34.624866  [**] [1:12345:3] GET on wire [**] [Classification: (null)] [Priority: 3] {TCP} 172.21.224.2:49652 -> 142.250.1.139:80
11/23/2022-12:38:58.958203  [**] [1:12345:3] GET on wire [**] [Classification: (null)] [Priority: 3] {TCP} 172.21.224.2:58494 -> 142.250.1.102:80
analyst@ee69e3317af7:~$ cat /var/log/suricata/eve.json
{"timestamp":"2022-11-23T12:38:34.624866+0000","flow_id":1916779820120213,"pcap_cnt":70,"event_type":"alert","src_ip":"172.21.224.2","src_port":49652,"dest_ip":"142.250.1.139","dest_port":80,"proto":"TCP","tx_id":0,"alert":{"action":"allowed","gid":1,"signature_id":12345,"rev":3,"signature":"GET on wire","category":"","severity":3},"http":{"hostname":"opensource.google.com","url":"/","http_user_agent":"curl/7.74.0","http_content_type":"text/html","http_method":"GET","protocol":"HTTP/1.1","status":301,"redirect":"https://opensource.google/","length":223},"app_proto":"http","flow":{"pkts_toserver":4,"pkts_toclient":3,"bytes_toserver":357,"bytes_toclient":788,"start":"2022-11-23T12:38:34.620693+0000"}}
{"timestamp":"2022-11-23T12:38:58.958203+0000","flow_id":567941047424244,"pcap_cnt":151,"event_type":"alert","src_ip":"172.21.224.2","src_port":58494,"dest_ip":"142.250.1.102","dest_port":80,"proto":"TCP","tx_id":0,"alert":{"action":"allowed","gid":1,"signature_id":12345,"rev":3,"signature":"GET on wire","category":"","severity":3},"http":{"hostname":"opensource.google.com","url":"/","http_user_agent":"curl/7.74.0","http_content_type":"text/html","http_method":"GET","protocol":"HTTP/1.1","status":301,"redirect":"https://opensource.google/","length":223},"app_proto":"http","flow":{"pkts_toserver":4,"pkts_toclient":3,"bytes_toserver":357,"bytes_toclient":797,"start":"2022-11-23T12:38:58.955636+0000"}}
analyst@ee69e3317af7:~$ jq . /var/log/suricata/eve.json | less
{
  "timestamp": "2022-11-23T12:38:34.624866+0000",
  "flow_id": 1916779820120213,
  "pcap_cnt": 70,
  "event_type": "alert",
  "src_ip": "172.21.224.2",
  "src_port": 49652,
  "dest_ip": "142.250.1.139",
  "dest_port": 80,
  "proto": "TCP",
  "tx_id": 0,
  "alert": {
    "action": "allowed",
    "gid": 1,
    "signature_id": 12345,
    "rev": 3,
    "signature": "GET on wire",
    "category": "",
    "severity": 3
  },
  "http": {
    "hostname": "opensource.google.com",
    "url": "/",
    "http_user_agent": "curl/7.74.0",
    "http_content_type": "text/html",
    "http_method": "GET",
    "protocol": "HTTP/1.1",
    "status": 301,
    "redirect": "https://opensource.google/",
    "length": 223
  },
  "app_proto": "http",
  "flow": {
    "pkts_toserver": 4,
    "pkts_toclient": 3,
    "bytes_toserver": 357,
    "bytes_toclient": 788,
    "start": "2022-11-23T12:38:34.620693+0000"
  }
}
{
  "timestamp": "2022-11-23T12:38:58.958203+0000",
  "flow_id": 567941047424244,
  "pcap_cnt": 151,
  "event_type": "alert",
  "src_ip": "172.21.224.2",
  "src_port": 58494,
  "dest_ip": "142.250.1.102",
  "dest_port": 80,
  "proto": "TCP",
  "tx_id": 0,
  "alert": {
    "action": "allowed",
    "gid": 1,
```

<p align="center"> 
<img src="https://i.gyazo.com/908d08f7f3f86c1c4c3a22b07d5984de.png" height="80%" width="80%" alt="tcpdump"/>

3. Use the jq command to extract specific event data from the eve.json file:
```
jq -c "[.timestamp,.flow_id,.alert.signature,.proto,.dest_ip]" /var/log/suricata/eve.json
```
The following is and example of the output of the command above. The flow_id is the long numeric field highlighted in orange in each row returned.
```
["2022-11-23T12:38:34.624866+0000",14500150016149,"GET on wire","TCP","142.250.1.139"]
["2022-11-23T12:38:58.958203+0000",1647223379236084,"GET on wire","TCP","142.250.1.102"]
```
4. Use the jq command to display all event logs related to a specific flow_id from the eve.json file. The flow_id value is a 16-digit number and will vary for each of the log entries. Replace X with any of the flow_id values returned by the previous query:


 ```
jq "select(.flow_id==X)" /var/log/suricata/eve.json
```

